# PodPal - A friend of the ORCA computational chemistry suite
[PodPal cover image - generated by Dall-E](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/blob/master/GUI/gui/ORCAs_pod_helper_CoverImage.png)

## Introduction
This repository contains code for the **P**ythonic **O**rca **D**ata **P**rocessing and **A**nalysis **L**ibrary, a Graphical User Interface (GUI) designed to streamline the creation and analysis of files generated by the [ORCA computational chemistry package](https://orcaforum.kofo.mpg.de/app.php/portal). Launch the GUI by running [Launcher.py](/GUI/Launcher.py) in your preferred Python environment. 

## Prerequisites
While the [Launcher](/GUI/Launcher.py) will prompt the installation of any missing packages and automatically add them to your system's PATH, it's advisable to pre-install the required software and Python modules before using the GUI.

### External software
Ensure the following software is installed on your system:

- **Python 3.11+**: Available from [Python Downloads](https://www.python.org/downloads/). During installation, add Python to your system's PATH and choose a convenient installation location, such as `C:\Python311`.
- **GitHub Desktop**: Available from [GitHub Desktop](https://desktop.github.com/). Installation does not require a GitHub account.
- **Git**: Available from [Git SCM](https://git-scm.com/). Install using the default settings in the suggested location, unless you have specific preferences. No GitHub account is required.

### Python modules
Install the necessary Python modules using `pip` in your command prompt:

```console
pip install importlib numpy scipy matplotlib git lxml PyQt6 pyarrow pandas openpyxl csv natsort
```

# GUI functions and usage
This GUI features 13 modules/tabs to facilitate workflows that use the ORCA computational suite, each of which has integrated error handling. Any errors or issues encountered will be reported to the `Status window`, prompting the user to adjust their input accordingly. Please report any unhandled/unclear errors or suggestions for additions to the code via the [Issues](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/issues) section.

## T1. CREST .xyz Splitter:
This module extracts conformers and their energies identified by the [Conformerâ€“Rotamer Ensemble Sampling Tool (CREST)](https://crest-lab.github.io/crest-docs/), an exceptionally efficient program for mapping low-energy conformations of any analyte. *XYZ* coordinates of each conformer are stored in the `crest_conformers.xyz` file, which is generated upon completion of a CREST run. The `CREST .xyz splitter` module extracts each conformer to individual `.gjf`, `.xyz`, or `.inp` files . Extracting of conformers to alternative file types will be added in future updates. 

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T1_CREST_xyz_splitter)**: 
1. **Select .xyz File**: 
    - Click the `Browse` button to open a file explorer window. Navigate to and select the `crest_conformers.xyz` file you wish to split, or paste the file path into the dialog box. 
2. **Specify Output Basename**: 
    - Enter a basename for the output files in the designated input box. Extracted geometries will be saved to files called `basename_N`, where N is a unique integer for conformer distinction.
3. **Export file type**: 
    - Choose whether to extract conformers from `crest_conformers.xyz` to `.gjf`, `.xyz`, or `.inp` files. 
4. **Execute Splitting**: 
    - Click the `Run` button to start the splitting process, which extracts all conformers from `crest_conformers.xyz` to individual `.gjf`, `.xyz`, or `.inp` files that are saved to a new directory called `Conformers`.
    - `Energies.csv`, a file summarizing the name, energy, and relative energy of each extracted conformer (sorted in ascending order), is also created and saved to `Conformers`. This file is directly compatible with [T2. Cosine similarity sorting](#T2-Cosine-similiarity-sorting)

## T2. Cosine similarity sorting:
This module processes multiple .gjf, .inp, and/or .xyz files to identify unique conformations using the cosine similarity method detailed [here](https://www.frontiersin.org/articles/10.3389/fchem.2019.00519/full). It is specifically designed to integrate with outputs from the [CREST .xyz Splitter](#T1-crest-xyz-splitter), including the `Energies.csv` file.

### Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T2_Cosine_sim):
1. **Directory or .csv input:**
    - Click the `Browse dir` button to select a directory containing your .gjf, .xyz, and/or .inp files, or paste the directory path into the dialog box.
    - Alternatively, use the `Browse .csv` button to select a .csv file, or paste the directory path into the dialog box. Ensure your .csv file is formatted correctly, with headers that are `Filename`, `Energy / hartree`, and `Relative Energy / kJ mol**-1`.
        - While the `Energies.csv` file generated by the CREST .xyz Splitter is already in the correct format, users may also supply their own .csv file, provided it adheres to the specified format: 
            - The .csv's first row must include these headers: `Filename` `Energy / hartree` and `Relative Energy / kJ mol**-1`. 
            - **Filename column**: Entries here must list the filename with its extension. The files mentioned must be located in the same directory as the Energies.csv file.
            - **Energy columns**:  Entries must be numeric and arranged in ascending energy order. An error will be displayed if the files are not sorted correctly or if the entries are not numeric.
            - The .csv file must include *at least* two rows beyond the header. Fewer entries imply that only a single file is present, precluding the possibility of any pairwise comparison.

2. **Setting the similiarity threshold:**
    - Adjust the `Cosine similarity threshold (*100):` field to set your desired threshold for similarity comparisons. Thresholds can be defined anywhere between 0.00 to 99.99.
    - The similiarity between two geometries is defined by the cosine of the angle between the two vectors $(\vec{V}_a, \vec{V}_b)$, where each vector is a 1D-array of the mass-weighted distance ($d_{CoM}$) of each atom *i* from the molecule's centre of mass ($CoM$):

    $$x_{CoM} = \frac{\sum_{i} x_i m_{i}}{\sum_{i} m_{i}}, \quad y_{CoM} = \frac{\sum_{i} y_i m_{i}}{\sum_{i} m_{i}}, \quad z_{CoM} = \frac{\sum_{i} z_i m_{i}}{\sum_{i} m_{i}}$$

    $$d_{CoM} = m_{i} \cdot \sqrt{(x_{i} - x_{CoM})^2 + (y_{i} - y_{CoM})^2 + (z_{i} - z_{CoM})^2}$$

    - The 1D array is sorted from smallest to largest so that variations in atom ordering from the input file and rotational equivalences (e.g., the C2 symmetry of the phenyl moiety) do not result in unique geometries. The cosine similarity between $(\vec{V}_a, \vec{V}_b)$ is then evaluated by:

    $$\text{sim}(\vec{V}_a, \vec{V}_b) = \left(1 - \left(\frac{1}{\pi} \right) \cdot \arccos\left(\frac{\vec{V}_a \cdot \vec{V}_b}{\|\vec{V}_a\| \cdot \|\vec{V}_b\|}\right)\right) \cdot 100$$

3. **Writing Pairwise Similarities:**
    - Check the `Write pairwise similarities to a .csv file?` option if you wish to save the results of the pairwise similarity comparisons to a .csv file. If checked, $sim(\vec{V}_a, \vec{V}_b)$ will be written to a .csv for each pairwise combination of molecules provided in the directory.

4. **Running the Analysis:**
    - Once you have configured your inputs and options, click the `Sort files by cosine similarity` button to initiate the analysis.
    - The module performs pairwise comparisons sequentially, beginning with the vector assoicated with the first file in the directory or .csv ($\vec{V}_a$)and proceeding to the last ($\vec{V}_b$).
        - A pairwise $sim(\vec{V}_a, \vec{V}_b)$ below the defined threshold identifies a unique geometry. Conversely, a similarity at or above the threshold indicates a duplicate geometry. Molecules identified as duplicates are excluded from any subsequent pairwise comparisons.
    - The comparison process then continues by calculating similarities between the first identified unique geometry (the first unique $\vec{V}_b$ identified when comparising against $\vec{V}_a$) and all other unique geometries, excluding the initial file ($\vec{V}_a$). This iterative approach repeats, exluding all duplicates and the initial vector $\vec{V}_a$ until no additional pairwise comparisons can be performed. This iterative process is shown below. 
    
        [Cosine similiarity sorting workflow](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/blob/master/Sample_Files/T2_Cosine_sim/Cosine_sim_sorting_workflow.png)
    - Unique isomers are saved to a newly created directory named `uniques_sim_N`, where N represents the similarity threshold.
    - If the `Write pairwise similiarities to a .csv file` option was checked, `pairwise_similiarities.csv` will be written to the `uniques_sim_N` directory. 

## T3. Generate ORCA .inp: 
This module processes a directory containing .gjf, .inp, and/or .xyz files and converts each into a new ORCA .inp file with its content controlled through the GUI interface. 

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T3_gjf_to_ORCA_inp)**: 
1. **Select directory**:
    - Use the `Browse` button to choose the directory containing at lease one .gjf, .xyz, and/or .inp file, or paste the path directly into the dialog box.
2. **Configure the performance settings**: 
    - Adjust the memory per core (in MB), number of cores, charge, and multiplicity as required for your calculations.
3. **Choose the calculation method**: 
    - Select a predefined method (DFT or CCSDT) or customize your own. The method line can be edited in the Custom mode for specific requirements.
4. **Compute ESP charges (optional)**: 
    - Optionally compute ESP charges by selecting the `Compute ESP Charges?` checkbox. This action enables additional input fields for grid and Rmax (both in Angstroms) and writes the following block to the .inp file:
        ```bash
        %chelpg
        grid 0.1
        rmax 3.0
        end
        ```
    - Reccomended values for $grid$ and $R_{max}$ are 0.1 Ã… and 3.0 Ã…, respectively. With these settings, the CHELPG partition scheme uses a grid composed of points spaced apart by 0.1 Ã…, where each $grid$ point is at most 3.0 Ã… away from any atom in the molecule. For larger molecules (> 350 electrons without pseudopotentials), using a coarser grid with the parameters $grid = 0.3 Ã…$ and $R_{max} = 3.0 Ã…$ is reccomended.
5. **Additional options**: 
    - Calculate the Hessian on the first optimization step. This writes the following block to the .inp file:
        ```bash
        %geom
        Calc_Hess true
        end
        ```
    - Compute dipole/quadrupole moments and isotropic polarizability. Selecting this option writes the following block to the .inp file:
        ```bash
        %elprop
        Dipole true
        Quadrupole true
        Polar 1
        end
        ```
    - Call XYZ coordinates from an external .xyz file. Selecting this option directly references an external .xyz file where the *XYZ* coordinate block would normally be in the .inp file. For example:
        ```bash
        *xyzfile 1 1 Fluoxetine_1.xyz
        ```
6. **Generate .inp files**: 
    - Click the `Run` button to create ORCA .inp files for each valid input file within the specified directory.
    - .inp files are saved to a new directory called `New_Inputs` or `New_Inputs_xyz` depending on whether the `Call XYZ coordinates from external .xyz file?` option was selected. 

## **T4. ORCA .out to ORCA .inp (Opt/Freq)**: 
This module processes a directory containing .out files from ORCA calculations, extracting the final geometries to generate new ORCA .inp files for optimization/frequency jobs. The configuration of these .inp files, including their content and options, is managed through the GUI interface.

### Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T4_ORCA_out_to_ORCA_inp):
The usage of this module aligns with the methods described in [T3. Generate ORCA .inp](#t3-generate-orca-inp), with one additional feature:
- **Additional Options**: There's an option to `Write final coordinates to a .gjf file`. Selecting this checkbox creates `.gjf` files alongside `.inp` files, facilitating visualization using external software packages like GaussView.

## **T5. ORCA .out to ORCA .inp (VGFC/TD-DFT)**
This module processes a directory containing .out files from ORCA calculations, extracting the final geometries to generate new ORCA .inp files for computing UV-Vis absorption spectra using the Vertical Gradient Franck-Condon (VG|FC) method, also known as the Independent Mode Displaced Harmonic Oscillator (IMDHO) model. The configuration of these .inp files is customizable via the GUI interface.

### Usage, and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T5_ORCA_out_to_ORCA_VGFC):
The usage of this module aligns with the methods described in [T3. Generate ORCA .inp](#t3-generate-orca-inp), with additional options specific to VG|FC calculations:
- **Directory**: Provide a path to a directory with ORCA .out files from a `Freq` job, ensuring both the `.out file` and its corresponding `.hess file` (generated upon completing the Freq job) share the same basename and are located in the same directory. If a .hess file is missing, an error will be reported, and no .inp file will be created file pair.
- **Performance Settings**: These remain unchanged from T3, though it is recommended to allocate additional memory per core for molecules to avoid out-of-memory errors (*ca.* 5000 MB for systems with 150+ electrons) 
- **Calculation Method**: While a default method is preset, customization is available. The method must include the `ESD(ABS)` keyword to initiate a VG|FC calculation. Future updates may expand support based on user feedback.
- **# states**: Define the number of excited states to be calculated, ranging from the ground state ($S_0$) to the N-th excited state ($S_N$): $S_0 \rightarrow S_N$
- **Additional Options**: There's an option to `Write final coordinates to a .gjf file`. Selecting this checkbox creates `.gjf` files alongside `.inp` files, facilitating visualization using external software packages like GaussView.

## **T6. Plot optimization trajectory**:
This module visualizes the optimization trajectory from an ORCA calculation, plotting energy changes, SCF energy, maximum gradient, maximum step, RMS gradient, and RMS step as functions of the number of optimization cycles. It is designed for ORCA .out file content generated as a result of performing geometry optimizations via the `opt` keyword (or any of its variants).

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T6_ORCAplt_OptTrajectory)**: 
1. **Select an ORCA .out file**:
    - Click the `Browse` button to navigate and select the desired .out file for analysis, or paste the directory path with the .out filename directly into the dialog box.
2. Save the plot (optional):
    - To save the generated plot, check the `Save the plot to an external file?` option.
3. Generate the Plot:
    - Click the `Plot` button to visualize the optimization trajectory based on the selected .out file. The plot contains the following information:
        - **Energy Change and SCF Energy**: Visualizes the overall energy progression and stability of the SCF calculations. The energy change should go to zero as the calculation progresses.
        - **Max gradient and step**: Highlights the largest gradient and step taken during optimization, indicating convergence towards a minimum.
        - **RMS gradient and step**: Provides a measure of the overall movement across all atoms.
        - If the .out file contains a single optimization step, only the **Energy Change** and **SCF Energy** plots will be generated. 

##  **T7. Calculate thermochemistry**: 
This module computes thermochemical corrections using the methodology described by [McQuarrie and Simon (1999)](https://gaussian.com/wp-content/uploads/dl/thermo.pdf) on each .out file in a directory that was generated from an inputs containing the `Freq` keyword (e.g., from an Opt Freq job). Users can specify temperature and pressure in which to evalaute thermochemistry, and whether to compute thermochemistry using scaled vibrational frequencies. Additionally, the module notifies users of incomplete Opt/Freq jobs and the presence of imaginary frequencies.

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T7_ORCAThermochemAnalyzer)**: 
1. **Select directory**: 
    - Use the `Browse` button to choose the directory that contains at least one .out file, or paste the directory path directly into the dialog box.
2. **Configure temperature and pressure**: 
    - Define the desired temperature (in Kelvin) and pressure (in Pascal) to evalaute thermochemical quantities at.
3. **Apply the vibrational scaling factor**:
    - Enter a multipliactive scaling factor to adjust all vibrational frequencies for anharmonicity. If no scaling is desired, leave at the default value of `1.00`:
        $$v_{\text{scaled}} = (\text{scaling factor}) \cdot v_{\text{orig}}$$
4. **Choose a sorting option**: 
    - Choose sorting criteria for output Excel columns, including Filename, Gibbs Energy (G), Enthalpy (H), Entropy (S), Thermal Energy (E), and Zero-point Energy (ZPE).
5. **Calculate thermochemistry**:
    - Click the `Run` button to begin the calculation process. Thermochemistry will be calculated for each .out file found within the provided directory and written to a .csv. 
    - The .csv file, named `Thermo_data_temp_pressure_vibscl.csv` (with temp, pressure, and vibscl representing the specified temperature, pressure, and vibrational scaling factor, respectively), includes:
        - Filename
        - Number of imaginary freqs
        - Electronic energy
        - Thermal energy
        - Total enthalpy (H)
        - Total entropy (T * S)
        - Gibbs energy (G) 
        - A, B, and C rotational constants
        - Rotational symmetry number
        - Dipole components (*X*, *Y*, *Z*) and total dipole moment
        - Isotropic polarizability
        - Partition functions (translational, rotational, vibrational, and electronic)

## **T8. Extract coupled cluster energies**: 
This module extracts coupled cluster energies from each .out file in a directory that was generated from an input requesting a coupled cluster calculation (e.g.,`! CCSD(T) cc-pVTZ`, `! CCSD cc-pVTZ`, and `! DLPNO-CCSD(T) cc-pVTZ cc-pVTZ/C`). Additional quantities are extracted to aid the user in evaluating the accuracy and reliability of their calculation.

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T8_ORCA_CCSDT_Analyzer)**: 
1. **Select directory**: 
    - Use the `Browse` button to choose the directory containing your ORCA .out files, or paste the file path directly into the dialog box.
2. **Extract Coupled Cluster Energies**:
    - Press the `Extract coupled cluster energies` button to begin the extraction process. Coupled cluster energies will be extracted from each .out file found within the provided directory and written to a .csv. 
    - The .csv file, named `Coupled_cluster_energies.csv`, includes:
        - Filename
        - CCSD(T) energy (if requested)
        - CCSD energy
        - Triples correction (if requested)
        - Final correlation energy
        - T1 diagnostic (a measure to evaluate the reliability of coupled cluster results). Values > 0.02 are unreliable. 

## **T9. Extract/plot IR spectra**: 
This module extracts vibrational frequency data from ORCA .out files to generate IR spectra. IR spectra are generating by applying a Gaussian convolution to each vibrational frequency, with the height of hte Gaussian calculated by ORCA from the change in molecule's dipole moment as it undergoes the specific vibration, and a Full Width at Half Maximum (FWHM) that can be customized by the user. The resulting spectra are exported to an Excel file on a user-specified range and step size in cm<sup>-1</sup>. Additionally, the module offers the option of scaling vibrational frequencies, normalizing spectra, and plotting to an external file.

### Inputs:
- **Directory**: Users must provide a directory path that contains at least one .out file. The directory can be selected through the GUI by clicking the `Browse` button.
- **Export range**: Define the range and the step size in *cm<sup>-1</sup>* for exporting the IR spectra.
- **FWHM**: Specify the Full Width at Half Maximum for Gaussian convolution. A default of 8 cm<sup>-1</sup> is recommended.
- **Scaling factor:**: Apply a multiplicative scaling factor to all vibrational frequencies to account for anharmonicity.
- **Normalize spectra?**: If checked, exported spectra will be normalized to a maximum value of 1.
- **Plot spectra externally?**: If checked, a plot of all exported spectra will be saved to a file with the basename `IR_spectra_plot.png`; the scaling factor and FWHM will be appended to the end of the file for later reference.

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T9_ORCA_Vib_Spectrum_Analyzer)**: 
1. **Select directory**: 
    - Use the `Browse` button to choose the directory containing at least one ORCA .out file, or paste the file path directly into the dialog box.
2. **Configure export range and step size**:
    - Set the export range (lower to upper bounds in *cm<sup>-1</sup>*) and the resolution (step size in *cm<sup>-1</sup>*) for the IR spectra.
3. **Set the FWHM**:
    - Adjust the FWHM for peak broadening. A FWHM of 8 cm<sup>-1</sup> is generally recommended.
4. **Apply the vibrational scaling factor**:
    - Enter a scaling factor for the vibrational frequencies if required. For no scaling, leave at the default value of `1.00`.
5. **Choose normalization and plotting options**:
    - Decide whether to normalize the spectra to unity and if an external plot should be created by checking the respective boxes.
6. **Extract/plot IR spectra**:
    - Click the `Extract/Plot IR spectra` button to begin the extraction process. The module performs Gaussian convolution on vibrational frequencies from each .out file in the specified directory, applies frequency scaling if requested, and compiles an Excel report along with an optional plot.
    - The Excel report, named `output_spectrum_.xlsx` or `output_spectrum_Norm.xlsx` (based on normalization choice), features a wavenumber column and individual columns for each file's IR spectrum, with headers matching the .out file names. Note that the scaling factor and FWHM will be appended to the end of the .xlsx file for later reference.
    - If plotting is enabled, the extracted IR spectra from all .out files will be plotted on a single figure and saved to `IR_spectra_plot.png`; the scaling factor and FWHM will be appended to the end of the file for later reference.

### **T10. Extract/plot UV-Vis spectra (VG-FC)**: 
Takes a directory containing a series of .spectrum.rootN and/or .spectrum files (can be for multiple analytes!) generated from Excited State Dynamics (ESD) simulations performed using ORCA and exports their spectra to an Excel file along a user specified range and energy unit (nm, cm**-1, or eV). Options:
    - **Input unit**: Specify the unit of energy of the data stored in the .spectrum / .spectrumrootN files (nm, cm**-1, or eV).
    - **Output unit**: Specify the unit of energy of that you would like your spectra to be exported as (nm, cm**-1, or eV).
    - **Export range**: Specify the range and step size for your exported spectra; default values applicable to most systems auto-update in the GUI interface. 
    - **Shift spectra**: Apply a uniform redshift/blueshift to the data in the .spectrum.rootN and .spectrum files for alignment with experimental data. Shifts can be specified in nm, cm**-1, or eV (eV reccomended due to non-liear spacing of the nm and cm**-1 scales.)
    - **Output basename**: The name that the output files will be called (no extensions or pathname)
    - **Normalize output**: Normalize spectra to a maximum value of 1
    - **Plot spectra externally**: Create and save additional plots of all exported spectra.     

### **Usage and [example files](https://github.com/HopkinsLaboratory/ORCA_Analysis_GUI/tree/master/Sample_Files/T8_ORCA_CCSDT_Analyzer)**: 

### **T11. Boltzmann-weight CCSs**: 
This module calculates the ensemble-averaged CCS of a molecule by Boltzmann-weighting the CCS of each conformation according to its population. Requires:

    - **DFT Thermochem .csv**: .csv file containing DFT electronic energies and thermochemistry, which is generated from the [**T7. Calculate thermochemistry**](#T7-calculate-thermochemistry) tab. 
    - **Coupled cluster .csv**: .csv file containing CCSD(T) or CCSD energies generated from the [**T8. Extract coupled cluster energies**](#T8-extract-coupled-cluster) tab.
    - **CCS .csv**: .csv file containing CCSs, which is generated from the [many .mout analyzer](https://github.com/HopkinsLaboratory/MobCal-MPI) function of the MobCal-MPI 2.0 GUI.

### **T12. ORCA LED analysis**: 
Plots the results from a Local Energy Decomposition (LED) analysis, decomposing the interaction energy between the parent molecule and its N fragments. Currently, the code supports two fragments (N = 2). Inputs:
    - 

### **T13. ORCA NEB analysis**: 
Plots the results from a Nudged Elastic Band (NEB) analysis, including the reaction coordinate during eachNEB interation along several user-specified parameters, including reaction coordinate, atomic distances, bond angles, or dihedral angles. Exporting the *XYZ* coordinates images from a specific run and generation of an ORCA .inp from these coordinates is also supported. Implementation will be including in the next major update. Inputs:
- _trj.xyz file from a NEB calculation 